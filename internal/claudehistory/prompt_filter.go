package claudehistory

import "strings"

const localCommandCaveat = "Caveat: The messages below were generated by the user while running local commands. DO NOT respond to these messages or otherwise consider them in your response unless the user explicitly asks you to."

var ignoredFirstPromptCommands = map[string]bool{
	"clear":  true,
	"login":  true,
	"logout": true,
	"exit":   true,
	"mcp":    true,
	"memory": true,
}

func shouldSkipFirstPrompt(text string) bool {
	trimmed := strings.TrimSpace(text)
	if trimmed == "" {
		return true
	}
	if strings.EqualFold(trimmed, "Warmup") {
		return true
	}
	if strings.EqualFold(trimmed, localCommandCaveat) {
		return true
	}
	if shouldSkipContent(trimmed) {
		return true
	}
	if strings.HasPrefix(trimmed, "/") {
		fields := strings.Fields(trimmed)
		if len(fields) > 0 {
			cmd := strings.TrimPrefix(fields[0], "/")
			cmd = strings.ToLower(cmd)
			if ignoredFirstPromptCommands[cmd] {
				return true
			}
		}
	}
	return false
}
